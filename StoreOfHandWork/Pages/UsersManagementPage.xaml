<?xml version="1.0" encoding="utf-8"?>
<Page x:Class="StoreOfHandWork.Pages.UsersManagementPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:sys="clr-namespace:System;assembly=mscorlib"
      mc:Ignorable="d" 
      d:DesignHeight="450" d:DesignWidth="800"
      Title="Управление пользователями">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Фильтры и поиск -->
        <StackPanel Grid.Row="0" 
                    Orientation="Horizontal" 
                    Margin="10">
            <TextBox x:Name="SearchBox" 
                     Width="200" 
                     Margin="0,0,10,0"
                     TextChanged="SearchBox_TextChanged"
                     VerticalContentAlignment="Center"
                     Padding="5,3">
                <TextBox.Style>
                    <Style TargetType="TextBox">
                        <Style.Resources>
                            <VisualBrush x:Key="HelpBrush" TileMode="None" Opacity="0.5" Stretch="None" AlignmentX="Left">
                                <VisualBrush.Visual>
                                    <TextBlock Text="Поиск пользователей..." Margin="5,0,0,0"/>
                                </VisualBrush.Visual>
                            </VisualBrush>
                        </Style.Resources>
                        <Style.Triggers>
                            <Trigger Property="Text" Value="{x:Null}">
                                <Setter Property="Background" Value="{StaticResource HelpBrush}"/>
                            </Trigger>
                            <Trigger Property="Text" Value="">
                                <Setter Property="Background" Value="{StaticResource HelpBrush}"/>
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </TextBox.Style>
            </TextBox>

            <ComboBox x:Name="RoleFilter"
                      Width="150"
                      Margin="0,0,10,0"
                      SelectionChanged="RoleFilter_SelectionChanged"
                      VerticalContentAlignment="Center">
                <ComboBoxItem Content="Все роли" IsSelected="True"/>
                <ComboBoxItem Content="Admin"/>
                <ComboBoxItem Content="User"/>
            </ComboBox>

            <ComboBox x:Name="StatusFilter"
                      Width="150"
                      SelectionChanged="StatusFilter_SelectionChanged"
                      VerticalContentAlignment="Center">
                <ComboBoxItem Content="Все статусы" IsSelected="True"/>
                <ComboBoxItem Content="Активен"/>
                <ComboBoxItem Content="Заблокирован"/>
            </ComboBox>
        </StackPanel>

        <!-- DataGrid с пользователями -->
        <DataGrid x:Name="UsersDataGrid"
                  Grid.Row="1"
                  Margin="10"
                  AutoGenerateColumns="False"
                  CanUserAddRows="False"
                  RowEditEnding="UsersDataGrid_RowEditEnding">
            <DataGrid.Columns>
                <DataGridTextColumn Header="Email"
                                  Binding="{Binding Email, UpdateSourceTrigger=PropertyChanged}"
                                  Width="*"/>
                <DataGridTextColumn Header="Имя"
                                  Binding="{Binding Name, UpdateSourceTrigger=PropertyChanged}"
                                  Width="*"/>
                <DataGridTextColumn Header="Телефон"
                                  Binding="{Binding Phone, UpdateSourceTrigger=PropertyChanged}"
                                  Width="*"/>
                <DataGridComboBoxColumn Header="Роль"
                                      SelectedItemBinding="{Binding Role, UpdateSourceTrigger=PropertyChanged}"
                                      Width="Auto">
                    <DataGridComboBoxColumn.ElementStyle>
                        <Style TargetType="ComboBox">
                            <Setter Property="ItemsSource">
                                <Setter.Value>
                                    <x:Array Type="sys:String">
                                        <sys:String>Admin</sys:String>
                                        <sys:String>User</sys:String>
                                    </x:Array>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </DataGridComboBoxColumn.ElementStyle>
                    <DataGridComboBoxColumn.EditingElementStyle>
                        <Style TargetType="ComboBox">
                            <Setter Property="ItemsSource">
                                <Setter.Value>
                                    <x:Array Type="sys:String">
                                        <sys:String>Admin</sys:String>
                                        <sys:String>User</sys:String>
                                    </x:Array>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </DataGridComboBoxColumn.EditingElementStyle>
                </DataGridComboBoxColumn>
                <DataGridComboBoxColumn Header="Статус"
                                      SelectedItemBinding="{Binding Status, UpdateSourceTrigger=PropertyChanged}"
                                      Width="Auto">
                    <DataGridComboBoxColumn.ElementStyle>
                        <Style TargetType="ComboBox">
                            <Setter Property="ItemsSource">
                                <Setter.Value>
                                    <x:Array Type="sys:String">
                                        <sys:String>Активен</sys:String>
                                        <sys:String>Заблокирован</sys:String>
                                    </x:Array>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </DataGridComboBoxColumn.ElementStyle>
                    <DataGridComboBoxColumn.EditingElementStyle>
                        <Style TargetType="ComboBox">
                            <Setter Property="ItemsSource">
                                <Setter.Value>
                                    <x:Array Type="sys:String">
                                        <sys:String>Активен</sys:String>
                                        <sys:String>Заблокирован</sys:String>
                                    </x:Array>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </DataGridComboBoxColumn.EditingElementStyle>
                </DataGridComboBoxColumn>
                <DataGridTemplateColumn Width="Auto">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal">
                                <Button Content="Сохранить"
                                        Click="SaveButton_Click"
                                        Background="#2196F3"
                                        Foreground="White"
                                        Padding="10,5"
                                        Margin="2">
                                    <Button.Style>
                                        <Style TargetType="Button">
                                            <Style.Triggers>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter Property="Background" Value="#1976D2"/>
                                                </Trigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Button.Style>
                                </Button>
                                <Button Content="Удалить"
                                        Click="DeleteButton_Click"
                                        Background="#f44336"
                                        Foreground="White"
                                        Padding="10,5"
                                        Margin="2">
                                    <Button.Style>
                                        <Style TargetType="Button">
                                            <Style.Triggers>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter Property="Background" Value="#d32f2f"/>
                                                </Trigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Button.Style>
                                </Button>
                            </StackPanel>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
            </DataGrid.Columns>
        </DataGrid>
    </Grid>
</Page>
